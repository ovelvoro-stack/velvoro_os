<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Velvoro â€“ Login & Data Entry</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    .box { max-width: 420px; margin: auto; }
    input, button { width: 100%; padding: 10px; margin: 6px 0; }
    .hidden { display: none; }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>

<div class="box">

  <!-- LOGIN SECTION -->
  <div id="loginSection">
    <h2>Login</h2>
    <input id="username" placeholder="Username" />
    <input id="password" type="password" placeholder="Password" />
    <button onclick="login()">Login</button>
    <div id="loginMsg"></div>
  </div>

  <!-- DATA ENTRY SECTION -->
  <div id="dataSection" class="hidden">
    <h2>Data Entry</h2>

    <input id="dataField1" placeholder="Field 1" />
    <input id="dataField2" placeholder="Field 2" />

    <button onclick="submitData()">Submit Data</button>
    <button onclick="logout()">Logout</button>

    <div id="dataMsg"></div>
  </div>

</div>

<script>
  let authToken = null;

  function login() {
    fetch("/auth/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        username: document.getElementById("username").value,
        password: document.getElementById("password").value
      })
    })
    .then(r => r.json())
    .then(d => {
      if (d.access_token || d.success) {
        authToken = d.access_token || "ok";
        document.getElementById("loginSection").classList.add("hidden");
        document.getElementById("dataSection").classList.remove("hidden");
        document.getElementById("loginMsg").innerHTML = "";
      } else {
        document.getElementById("loginMsg").innerHTML =
          "<div class='error'>" + (d.detail || "Login failed") + "</div>";
      }
    })
    .catch(() => {
      document.getElementById("loginMsg").innerHTML =
        "<div class='error'>Server error</div>";
    });
  }

  function submitData() {
    fetch("/data-entry/submit", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": authToken ? "Bearer " + authToken : ""
      },
      body: JSON.stringify({
        field1: document.getElementById("dataField1").value,
        field2: document.getElementById("dataField2").value
      })
    })
    .then(r => r.json())
    .then(d => {
      document.getElementById("dataMsg").innerHTML =
        "<div class='success'>Data submitted successfully</div>";
    })
    .catch(() => {
      document.getElementById("dataMsg").innerHTML =
        "<div class='error'>Submit failed</div>";
    });
  }

  function logout() {
    authToken = null;
    document.getElementById("dataSection").classList.add("hidden");
    document.getElementById("loginSection").classList.remove("hidden");
  }
</script>

</body>
</html>
